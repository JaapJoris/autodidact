#!/bin/sh

set -e

#DEBHELPER#

case $1 in
    configure)
        if [ ! -e /etc/bps/secret.key ]
	then
	    umask 027
	    makepasswd --chars=50 >/etc/bps/secret.key
	    chgrp www-data /etc/bps/secret.key
	fi
	project_dir=`python -c 'import os,bps; print os.path.dirname(bps.__file__)'`
	sed -i "s:%PROJECT_DIR%:$project_dir:" /etc/apache2/conf-available/bps.conf
	yes yes | manage.py collectstatic
        manage.py migrate
esac
